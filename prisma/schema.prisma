generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum EngagementType {
  TIME_BASED
  PROJECT_BASED
}

enum ProjectStatus {
  ACTIVE
  PAUSED
  ARCHIVED
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  clients      Client[]
  links         Link[]
  files         File[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Client {
  id                 String         @id @default(cuid())
  userId             String
  name               String
  engagementType     EngagementType @default(TIME_BASED)
  workingDaysPerWeek Int?
  workingHoursPerDay Int?
  email              String?
  phone              String?
  whatsapp           String?
  address            String?
  notes              String?
  user               User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects           Project[]
  links              Link[]
  files              File[]
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  @@index([userId])
}

model Project {
  id          String        @id @default(cuid())
  clientId    String
  name        String
  description String?
  status      ProjectStatus @default(ACTIVE)
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  codebases   Codebase[]
  links       Link[]
  files       File[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([clientId])
}

model Codebase {
  id          String       @id @default(cuid())
  projectId   String
  name        String
  description String?
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  links       Link[]
  files       File[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([projectId])
}

model Link {
  id         String       @id @default(cuid())
  userId     String
  clientId   String?
  projectId  String?
  codebaseId String?
  title      String
  url        String
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  client     Client?      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project    Project?     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  codebase   Codebase?    @relation(fields: [codebaseId], references: [id], onDelete: Cascade)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([userId])
  @@index([clientId])
  @@index([projectId])
  @@index([codebaseId])
}

model File {
  id          String    @id @default(cuid())
  userId      String
  clientId    String?
  projectId   String?
  codebaseId  String?
  filename    String
  storagePath String
  mimeType    String
  sizeBytes   Int
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  client      Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project     Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  codebase    Codebase? @relation(fields: [codebaseId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId])
  @@index([clientId])
  @@index([projectId])
  @@index([codebaseId])
}
